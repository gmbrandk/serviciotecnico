<div
  class="markdown prose dark:prose-invert w-full break-words dark markdown-new-styling"
>
  <p data-start="0" data-end="160">
    Perfecto üëå, te armo un
    <strong data-start="24" data-end="106"
      >ToDoList para el servicio de actualizaci√≥n/edici√≥n (<code
        data-start="78"
        data-end="103"
        >actualizarEquipoService</code
      >)</strong
    >
    basado en lo que ya tienes en
    <code data-start="137" data-end="157">crearEquipoService</code>.
  </p>
  <hr data-start="162" data-end="165" />
  <h1 data-start="167" data-end="210">
    ‚úÖ ToDoList para
    <code data-start="185" data-end="210">actualizarEquipoService</code>
  </h1>
  <h3 data-start="212" data-end="245">
    1. <strong data-start="219" data-end="245">Validaciones iniciales</strong>
  </h3>
  <ul class="contains-task-list" data-start="246" data-end="509">
    <li class="task-list-item" data-start="246" data-end="306">
      <p data-start="252" data-end="306">
        <input disabled="" type="checkbox" /> Verificar que venga un
        <code data-start="275" data-end="285">equipoId</code> v√°lido (ObjectId).
      </p>
    </li>
    <li data-start="307" data-end="435" class="task-list-item">
      <p data-start="313" data-end="435">
        <input disabled="" type="checkbox" /> Validar
        <code data-start="321" data-end="327">tipo</code>,
        <code data-start="329" data-end="337">modelo</code> y
        <code data-start="340" data-end="355">clienteActual</code> si son parte
        de la actualizaci√≥n (algunos podr√≠an ser opcionales en edici√≥n).
      </p>
    </li>
    <li data-start="436" data-end="509" class="task-list-item">
      <p data-start="442" data-end="509">
        <input disabled="" type="checkbox" /> Si
        <code data-start="445" data-end="463">tipo === celular</code>, validar
        que venga un
        <code data-start="486" data-end="492">imei</code> (obligatorio).
      </p>
    </li>
  </ul>
  <hr data-start="511" data-end="514" />
  <h3 data-start="516" data-end="539">
    2. <strong data-start="523" data-end="539">Sanitizaci√≥n</strong>
  </h3>
  <ul class="contains-task-list" data-start="540" data-end="679">
    <li class="task-list-item" data-start="540" data-end="679">
      <p data-start="546" data-end="613">
        <input disabled="" type="checkbox" /> Normalizar (<code
          data-start="558"
          data-end="563"
          >xss</code
        >, <code data-start="565" data-end="571">trim</code>,
        <code data-start="573" data-end="586">toUpperCase</code>) todos los
        campos clave:
      </p>
      <ul data-start="616" data-end="679">
        <li data-start="616" data-end="679">
          <p data-start="618" data-end="679">
            <code data-start="618" data-end="623">sku</code>,
            <code data-start="625" data-end="635">nroSerie</code>,
            <code data-start="637" data-end="649">macAddress</code>,
            <code data-start="651" data-end="657">imei</code>,
            <code data-start="659" data-end="666">marca</code>,
            <code data-start="668" data-end="676">modelo</code>.
          </p>
        </li>
      </ul>
    </li>
  </ul>
  <hr data-start="681" data-end="684" />
  <h3 data-start="686" data-end="732">
    3.
    <strong data-start="693" data-end="732"
      >Reglas de unicidad en actualizaci√≥n</strong
    >
  </h3>
  <ul data-start="733" data-end="1218" class="contains-task-list">
    <li data-start="733" data-end="962" class="task-list-item">
      <p data-start="739" data-end="767">
        <input disabled="" type="checkbox" /> Si llega un
        <strong data-start="751" data-end="766"
          >nuevo <code data-start="759" data-end="764">sku</code></strong
        >:
      </p>
      <ul data-start="770" data-end="962">
        <li data-start="770" data-end="852">
          <p data-start="772" data-end="852">
            Si es vac√≠o ‚Üí generar
            <code data-start="794" data-end="807">TMP-SKU-...</code> y poner
            <code data-start="816" data-end="849"
              >estadoIdentificacion = temporal</code
            >.
          </p>
        </li>
        <li data-start="855" data-end="962">
          <p data-start="857" data-end="962">
            Si es v√°lido ‚Üí setear
            <code data-start="879" data-end="914"
              >estadoIdentificacion = definitiva</code
            >
            (si no hay otros identificadores temporales).
          </p>
        </li>
      </ul>
    </li>
    <li class="task-list-item" data-start="963" data-end="1120">
      <p data-start="969" data-end="1002">
        <input disabled="" type="checkbox" /> Si llega un
        <strong data-start="981" data-end="1001"
          >nuevo <code data-start="989" data-end="999">nroSerie</code></strong
        >:
      </p>
      <ul data-start="1005" data-end="1120">
        <li data-start="1005" data-end="1053">
          <p data-start="1007" data-end="1053">
            Validar que no est√© repetido en otro equipo.
          </p>
        </li>
        <li data-start="1056" data-end="1120">
          <p data-start="1058" data-end="1120">
            Si es vac√≠o ‚Üí generar
            <code data-start="1080" data-end="1092">TMP-SN-...</code> y marcar
            como <code data-start="1107" data-end="1117">temporal</code>.
          </p>
        </li>
      </ul>
    </li>
    <li class="task-list-item" data-start="1121" data-end="1218">
      <p data-start="1127" data-end="1218">
        <input disabled="" type="checkbox" /> Lo mismo para
        <strong data-start="1141" data-end="1151"
          ><code data-start="1143" data-end="1149">imei</code></strong
        >
        y
        <strong data-start="1154" data-end="1170"
          ><code data-start="1156" data-end="1168">macAddress</code></strong
        >
        (√∫nicos si vienen, ignorados si no se pasan).
      </p>
    </li>
  </ul>
  <hr data-start="1220" data-end="1223" />
  <h3 data-start="1225" data-end="1269">
    4.
    <strong data-start="1232" data-end="1269"
      >Gesti√≥n de
      <code data-start="1245" data-end="1267"
        >estadoIdentificacion</code
      ></strong
    >
  </h3>
  <ul data-start="1270" data-end="1457" class="contains-task-list">
    <li data-start="1270" data-end="1386" class="task-list-item">
      <p data-start="1276" data-end="1386">
        <input disabled="" type="checkbox" /> Si despu√©s de la edici√≥n todos los
        identificadores (<code data-start="1328" data-end="1333">sku</code> y
        <code data-start="1336" data-end="1346">nroSerie</code>) son reales ‚Üí
        cambiar a <code data-start="1371" data-end="1383">definitiva</code>.
      </p>
    </li>
    <li class="task-list-item" data-start="1387" data-end="1457">
      <p data-start="1393" data-end="1457">
        <input disabled="" type="checkbox" /> Si al menos uno sigue siendo
        <code data-start="1422" data-end="1429">TMP-*</code> ‚Üí mantener en
        <code data-start="1444" data-end="1454">temporal</code>.
      </p>
    </li>
  </ul>
  <hr data-start="1459" data-end="1462" />
  <h3 data-start="1464" data-end="1517">
    5.
    <strong data-start="1471" data-end="1517"
      >Actualizaci√≥n de historial de propietarios</strong
    >
  </h3>
  <ul data-start="1518" data-end="1731" class="contains-task-list">
    <li data-start="1518" data-end="1731" class="task-list-item">
      <p data-start="1524" data-end="1561">
        <input disabled="" type="checkbox" /> Detectar si
        <code data-start="1536" data-end="1551">clienteActual</code> cambi√≥.
      </p>
      <ul data-start="1564" data-end="1731">
        <li data-start="1564" data-end="1731">
          <p data-start="1566" data-end="1585">
            Si <strong data-start="1569" data-end="1582">s√≠ cambi√≥</strong>:
          </p>
          <ul data-start="1590" data-end="1731">
            <li data-start="1590" data-end="1640">
              <p data-start="1592" data-end="1640">
                Cerrar el historial activo (<code
                  data-start="1620"
                  data-end="1636"
                  >fechaFin = now</code
                >).
              </p>
            </li>
            <li data-start="1645" data-end="1731">
              <p data-start="1647" data-end="1731">
                Crear un nuevo registro en
                <code data-start="1674" data-end="1697"
                  >historialPropietarios</code
                >
                con
                <code data-start="1702" data-end="1728"
                  >clienteId = clienteNuevo</code
                >.
              </p>
            </li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
  <hr data-start="1733" data-end="1736" />
  <h3 data-start="1738" data-end="1762">
    6. <strong data-start="1745" data-end="1762">Ficha t√©cnica</strong>
  </h3>
  <ul class="contains-task-list" data-start="1763" data-end="2036">
    <li class="task-list-item" data-start="1763" data-end="2036">
      <p data-start="1769" data-end="1803">
        <input disabled="" type="checkbox" /> Si
        <code data-start="1772" data-end="1779">marca</code> o
        <code data-start="1782" data-end="1790">modelo</code> cambiaron:
      </p>
      <ul data-start="1806" data-end="2036">
        <li data-start="1806" data-end="1891">
          <p data-start="1808" data-end="1891">
            Intentar
            <strong data-start="1817" data-end="1861"
              >re-vincular una ficha t√©cnica autom√°tica</strong
            >
            con
            <code data-start="1866" data-end="1888">vincularFichaTecnica</code>.
          </p>
        </li>
        <li data-start="1894" data-end="2036">
          <p data-start="1896" data-end="2036">
            Si no existe y viene
            <code data-start="1917" data-end="1937">fichaTecnicaManual</code> +
            <code data-start="1940" data-end="1973"
              >permitirCrearFichaTecnicaManual</code
            >
            ‚Üí crear ficha t√©cnica manual con
            <code data-start="2007" data-end="2033"
              >crearFichaTecnicaService</code
            >.
          </p>
        </li>
      </ul>
    </li>
  </ul>
  <hr data-start="2038" data-end="2041" />
  <h3 data-start="2043" data-end="2079">
    7.
    <strong data-start="2050" data-end="2079">Especificaciones t√©cnicas</strong>
  </h3>
  <ul class="contains-task-list" data-start="2080" data-end="2230">
    <li class="task-list-item" data-start="2080" data-end="2230">
      <p data-start="2086" data-end="2230">
        <input disabled="" type="checkbox" /> Recalcular
        <code data-start="2097" data-end="2123">especificacionesActuales</code>
        y <code data-start="2126" data-end="2140">repotenciado</code> con
        <code data-start="2145" data-end="2177"
          >calcularEspecificacionesEquipo</code
        >, si hay cambios de ficha t√©cnica o specs manuales.
      </p>
    </li>
  </ul>
  <hr data-start="2232" data-end="2235" />
  <h3 data-start="2237" data-end="2260">
    8. <strong data-start="2244" data-end="2260">Persistencia</strong>
  </h3>
  <ul class="contains-task-list" data-start="2261" data-end="2356">
    <li class="task-list-item" data-start="2261" data-end="2313">
      <p data-start="2267" data-end="2313">
        <input disabled="" type="checkbox" /> Guardar cambios en
        <code data-start="2286" data-end="2310">equipoExistente.save()</code>.
      </p>
    </li>
    <li class="task-list-item" data-start="2314" data-end="2356">
      <p data-start="2320" data-end="2356">
        <input disabled="" type="checkbox" /> Retornar el documento actualizado.
      </p>
    </li>
  </ul>
  <hr data-start="2358" data-end="2361" />
  <h3 data-start="2363" data-end="2391">
    9. <strong data-start="2370" data-end="2391">Errores a manejar</strong>
  </h3>
  <ul class="contains-task-list" data-start="2392" data-end="2661">
    <li class="task-list-item" data-start="2392" data-end="2606">
      <p data-start="2398" data-end="2428">
        <input disabled="" type="checkbox" /> Lanzar
        <code data-start="2405" data-end="2422">ValidationError</code> si:
      </p>
      <ul data-start="2431" data-end="2606">
        <li data-start="2431" data-end="2492">
          <p data-start="2433" data-end="2492">
            Se intenta asignar un
            <code data-start="2455" data-end="2461">imei</code> en equipo que no
            es celular.
          </p>
        </li>
        <li data-start="2495" data-end="2533">
          <p data-start="2497" data-end="2533">
            Se pasa <code data-start="2505" data-end="2511">imei</code> vac√≠o en
            celulares.
          </p>
        </li>
        <li data-start="2536" data-end="2606">
          <p data-start="2538" data-end="2606">
            Se intenta guardar un
            <code data-start="2560" data-end="2565">sku</code> o
            <code data-start="2568" data-end="2578">nroSerie</code> duplicado en
            otro equipo.
          </p>
        </li>
      </ul>
    </li>
    <li class="task-list-item" data-start="2607" data-end="2661">
      <p data-start="2613" data-end="2661">
        <input disabled="" type="checkbox" /> Lanzar error si no se encuentra el
        <code data-start="2648" data-end="2658">equipoId</code>.
      </p>
    </li>
  </ul>
  <hr data-start="2663" data-end="2666" />
  <p data-start="2668" data-end="2803">
    üëâ Con este ToDoList b√°sicamente el
    <code data-start="2704" data-end="2729">actualizarEquipoService</code>
    tendr√≠a la misma
    <strong data-start="2747" data-end="2800"
      >filosof√≠a de robustez que el
      <code data-start="2778" data-end="2798">crearEquipoService</code></strong
    >:
  </p>
  <ul data-start="2804" data-end="2993">
    <li data-start="2804" data-end="2833">
      <p data-start="2806" data-end="2833">nunca dejar datos vac√≠os,</p>
    </li>
    <li data-start="2834" data-end="2871">
      <p data-start="2836" data-end="2871">asegurar unicidad con temporales,</p>
    </li>
    <li data-start="2872" data-end="2929">
      <p data-start="2874" data-end="2929">
        mantener un estado claro (<code data-start="2900" data-end="2910"
          >temporal</code
        >
        o <code data-start="2913" data-end="2925">definitiva</code>),
      </p>
    </li>
    <li data-start="2930" data-end="2993">
      <p data-start="2932" data-end="2993">
        y proteger la consistencia de hist√≥ricos + fichas t√©cnicas.
      </p>
    </li>
  </ul>
  <hr data-start="2995" data-end="2998" />
  <p
    data-start="3000"
    data-end="3144"
    data-is-last-node=""
    data-is-only-node=""
  >
    ¬øQuieres que te lo arme ya directamente en c√≥digo (<code
      data-start="3051"
      data-end="3079"
      >actualizarEquipoService.js</code
    >) siguiendo estos puntos, para que quede alineado al de creaci√≥n?
  </p>
</div>
