<div
  class="markdown prose dark:prose-invert w-full break-words dark markdown-new-styling"
>
  <p data-start="0" data-end="200">
    Aquí tienes un
    <strong data-start="15" data-end="64"
      >ToDo List claro, ordenado y ejecutable mañana</strong
    >, enfocado en resolver tu problema de persistencia, consistencia de líneas
    (nuevas, modificadas, eliminadas) y carga segura del payload.
  </p>
  <p data-start="202" data-end="244">
    Es un plan de trabajo de 1–2 horas máximo.
  </p>
  <hr data-start="246" data-end="249" />
  <h1 data-start="251" data-end="327">
    <strong data-start="253" data-end="327"
      >ToDo List – Implementación de Persistencia Segura + Estado
      Consistente</strong
    >
  </h1>
  <hr data-start="329" data-end="332" />
  <h2 data-start="334" data-end="376">
    <strong data-start="337" data-end="376"
      >1. Crear util de persistencia local</strong
    >
  </h2>
  <h3 data-start="377" data-end="400">Archivo sugerido:</h3>
  <p data-start="401" data-end="428">
    <code data-start="401" data-end="428">src/utils/draftStorage.js</code>
  </p>
  <h3 data-start="430" data-end="441">Tareas:</h3>
  <ul class="contains-task-list" data-start="442" data-end="720">
    <li class="task-list-item" data-start="442" data-end="484">
      <p data-start="448" data-end="484">
        <input disabled="" type="checkbox" /> Crear función
        <code data-start="462" data-end="482">getStorageKey(ids)</code>
      </p>
    </li>
    <li class="task-list-item" data-start="485" data-end="523">
      <p data-start="491" data-end="523">
        <input disabled="" type="checkbox" /> Implementar
        <code data-start="503" data-end="523">SCHEMA_VERSION = 1</code>
      </p>
    </li>
    <li class="task-list-item" data-start="524" data-end="560">
      <p data-start="530" data-end="560">
        <input disabled="" type="checkbox" /> Implementar
        <code data-start="542" data-end="560">EXPIRES_IN = 48h</code>
      </p>
    </li>
    <li class="task-list-item" data-start="561" data-end="669">
      <p data-start="567" data-end="583">
        <input disabled="" type="checkbox" /> Crear funciones:
      </p>
      <ul class="contains-task-list" data-start="586" data-end="669">
        <li class="task-list-item" data-start="586" data-end="618">
          <p data-start="588" data-end="618">
            <input disabled="" type="checkbox" />
            <code data-start="592" data-end="618"
              >saveDraft(key, snapshot)</code
            >
          </p>
        </li>
        <li class="task-list-item" data-start="621" data-end="643">
          <p data-start="623" data-end="643">
            <input disabled="" type="checkbox" />
            <code data-start="627" data-end="643">loadDraft(key)</code>
          </p>
        </li>
        <li class="task-list-item" data-start="646" data-end="669">
          <p data-start="648" data-end="669">
            <input disabled="" type="checkbox" />
            <code data-start="652" data-end="669">clearDraft(key)</code>
          </p>
        </li>
      </ul>
    </li>
    <li class="task-list-item" data-start="670" data-end="720">
      <p data-start="676" data-end="720">
        <input disabled="" type="checkbox" /> Incluir validación: schema, TTL,
        estructura.
      </p>
    </li>
  </ul>
  <p data-start="722" data-end="815">
    Esto crea la base para evitar que se “revivan” líneas eliminadas o se
    pierdan modificaciones.
  </p>
  <hr data-start="817" data-end="820" />
  <h2 data-start="822" data-end="880">
    <strong data-start="825" data-end="880"
      >2. Integrar persistencia en
      <code data-start="855" data-end="878">useIngresoInitialLoad</code></strong
    >
  </h2>
  <h3 data-start="881" data-end="904">Lo que debes hacer:</h3>
  <ul class="contains-task-list" data-start="905" data-end="1164">
    <li class="task-list-item" data-start="905" data-end="978">
      <p data-start="911" data-end="978">
        <input disabled="" type="checkbox" /> Al terminar
        <code data-start="923" data-end="938">loadPayload()</code>, generar y
        guardar snapshot en storage.
      </p>
    </li>
    <li data-start="979" data-end="1082" class="task-list-item">
      <p data-start="985" data-end="1003">
        <input disabled="" type="checkbox" /> Al montar el hook:
      </p>
      <ul class="contains-task-list" data-start="1006" data-end="1082">
        <li class="task-list-item" data-start="1006" data-end="1034">
          <p data-start="1012" data-end="1034">
            <input disabled="" type="checkbox" /> Intentar cargar draft.
          </p>
        </li>
        <li class="task-list-item" data-start="1037" data-end="1082">
          <p data-start="1043" data-end="1082">
            <input disabled="" type="checkbox" /> Si existe → usarlo como estado
            inicial.
          </p>
        </li>
      </ul>
    </li>
    <li class="task-list-item" data-start="1083" data-end="1164">
      <p data-start="1089" data-end="1164">
        <input disabled="" type="checkbox" /> Si hay
        <code data-start="1096" data-end="1112">initialPayload</code> y
        <strong data-start="1115" data-end="1121">NO</strong> hay borrador
        válido → guardar nuevo draft.
      </p>
    </li>
  </ul>
  <p data-start="1166" data-end="1193">Este paso te asegurará que:</p>
  <ul data-start="1195" data-end="1290">
    <li data-start="1195" data-end="1223">
      <p data-start="1197" data-end="1223">Líneas nuevas permanecen</p>
    </li>
    <li data-start="1224" data-end="1257">
      <p data-start="1226" data-end="1257">Líneas modificadas permanecen</p>
    </li>
    <li data-start="1258" data-end="1290">
      <p data-start="1260" data-end="1290">Líneas eliminadas permanecen</p>
    </li>
  </ul>
  <p data-start="1292" data-end="1319">AUN al reiniciar la página.</p>
  <hr data-start="1321" data-end="1324" />
  <h2 data-start="1326" data-end="1378">
    <strong data-start="1329" data-end="1378"
      >3. Integrar autosave dentro de useIngresoForm</strong
    >
  </h2>
  <h3 data-start="1379" data-end="1390">Tareas:</h3>
  <ul class="contains-task-list" data-start="1391" data-end="1547">
    <li class="task-list-item" data-start="1391" data-end="1491">
      <p data-start="1397" data-end="1431">
        <input disabled="" type="checkbox" /> Añadir un
        <code data-start="1407" data-end="1418">useEffect</code> que observe:
      </p>
      <ul data-start="1434" data-end="1491">
        <li data-start="1434" data-end="1443">
          <p data-start="1436" data-end="1443">cliente</p>
        </li>
        <li data-start="1446" data-end="1454">
          <p data-start="1448" data-end="1454">equipo</p>
        </li>
        <li data-start="1457" data-end="1466">
          <p data-start="1459" data-end="1466">tecnico</p>
        </li>
        <li data-start="1469" data-end="1491">
          <p data-start="1471" data-end="1491">orden.lineasServicio</p>
        </li>
      </ul>
    </li>
    <li class="task-list-item" data-start="1492" data-end="1547">
      <p data-start="1498" data-end="1547">
        <input disabled="" type="checkbox" /> Guardar snapshot al storage cada
        vez que cambien.
      </p>
    </li>
  </ul>
  <p data-start="1549" data-end="1575">Si quieres más eficiencia:</p>
  <ul class="contains-task-list" data-start="1576" data-end="1610">
    <li class="task-list-item" data-start="1576" data-end="1610">
      <p data-start="1582" data-end="1610">
        <input disabled="" type="checkbox" /> Hacer debounce de 300–500ms.
      </p>
    </li>
  </ul>
  <hr data-start="1612" data-end="1615" />
  <h2 data-start="1617" data-end="1662">
    <strong data-start="1620" data-end="1662"
      >4. Actualizar el manejo de originalRef</strong
    >
  </h2>
  <p data-start="1663" data-end="1694">Actualmente, después de reload:</p>
  <ul data-start="1696" data-end="1831">
    <li data-start="1696" data-end="1754">
      <p data-start="1698" data-end="1754">
        originalRef NO contiene la versión modificada/eliminada.
      </p>
    </li>
    <li data-start="1755" data-end="1831">
      <p data-start="1757" data-end="1831">
        El componente interpreta todo como "nuevo estado proveniente del
        payload".
      </p>
    </li>
  </ul>
  <h3 data-start="1833" data-end="1844">Tareas:</h3>
  <ul class="contains-task-list" data-start="1845" data-end="2071">
    <li class="task-list-item" data-start="1845" data-end="1930">
      <p data-start="1851" data-end="1930">
        <input disabled="" type="checkbox" /> Cuando se cargue desde draft →
        originalRef debe cargarse desde ese mismo draft.
      </p>
    </li>
    <li class="task-list-item" data-start="1931" data-end="1995">
      <p data-start="1937" data-end="1995">
        <input disabled="" type="checkbox" /> Cuando se haga un reset de línea →
        actualizar originalRef.
      </p>
    </li>
    <li class="task-list-item" data-start="1996" data-end="2071">
      <p data-start="2002" data-end="2071">
        <input disabled="" type="checkbox" /> Cuando se elimine una línea →
        marcarla en originalRef como eliminada.
      </p>
    </li>
  </ul>
  <p data-start="2073" data-end="2086">Esto arregla:</p>
  <ul data-start="2088" data-end="2146">
    <li data-start="2088" data-end="2100">
      <p data-start="2090" data-end="2100">Los badges</p>
    </li>
    <li data-start="2101" data-end="2112">
      <p data-start="2103" data-end="2112">Los diffs</p>
    </li>
    <li data-start="2113" data-end="2126">
      <p data-start="2115" data-end="2126">Los estados</p>
    </li>
    <li data-start="2127" data-end="2146">
      <p data-start="2129" data-end="2146">El fallback en UI</p>
    </li>
  </ul>
  <hr data-start="2148" data-end="2151" />
  <h2 data-start="2153" data-end="2194">
    <strong data-start="2156" data-end="2194"
      >5. Ajustar lógica en LineaServicio</strong
    >
  </h2>
  <h3 data-start="2195" data-end="2222">Cosas a revisar mañana:</h3>
  <ul class="contains-task-list" data-start="2223" data-end="2462">
    <li class="task-list-item" data-start="2223" data-end="2281">
      <p data-start="2229" data-end="2281">
        <input disabled="" type="checkbox" /> Confirmar que
        <code data-start="2243" data-end="2260">data._fromReset</code> llega
        correctamente.
      </p>
    </li>
    <li class="task-list-item" data-start="2282" data-end="2355">
      <p data-start="2288" data-end="2355">
        <input disabled="" type="checkbox" /> Confirmar que
        <code data-start="2302" data-end="2317">deleted: true</code> se respeta
        y se ignora al renderizar.
      </p>
    </li>
    <li data-start="2356" data-end="2462" class="task-list-item">
      <p data-start="2362" data-end="2462">
        <input disabled="" type="checkbox" /> Confirmar que los badge de
        "Nueva", "Modificada" y "Cambiada" funcionan con originalRef
        actualizado.
      </p>
    </li>
  </ul>
  <hr data-start="2464" data-end="2467" />
  <h2 data-start="2469" data-end="2530">
    <strong data-start="2472" data-end="2530"
      >6. Agregar limpieza del storage al finalizar el wizard</strong
    >
  </h2>
  <p data-start="2531" data-end="2554">
    En <code data-start="2534" data-end="2553">handleFinalSubmit</code>:
  </p>
  <ul data-start="2556" data-end="2601" class="contains-task-list">
    <li data-start="2556" data-end="2601" class="task-list-item">
      <p data-start="2562" data-end="2601">
        <input disabled="" type="checkbox" /> Llamar
        <code data-start="2569" data-end="2601"
          >clearDraft(getStorageKey(ids))</code
        >
      </p>
    </li>
  </ul>
  <p data-start="2603" data-end="2623">
    En <code data-start="2606" data-end="2622">resetClienteId</code>:
  </p>
  <ul class="contains-task-list" data-start="2625" data-end="2670">
    <li class="task-list-item" data-start="2625" data-end="2670">
      <p data-start="2631" data-end="2670">
        <input disabled="" type="checkbox" /> Llamar
        <code data-start="2638" data-end="2670"
          >clearDraft(getStorageKey(ids))</code
        >
      </p>
    </li>
  </ul>
  <p data-start="2672" data-end="2683">Esto evita:</p>
  <ul data-start="2685" data-end="2793">
    <li data-start="2685" data-end="2735">
      <p data-start="2687" data-end="2735">
        Reaparecer líneas borradas de un flujo anterior.
      </p>
    </li>
    <li data-start="2736" data-end="2793">
      <p data-start="2738" data-end="2793">
        Cargar información incorrecta al crear una nueva orden.
      </p>
    </li>
  </ul>
  <hr data-start="2795" data-end="2798" />
  <h2 data-start="2800" data-end="2833">
    <strong data-start="2803" data-end="2833"
      >7. Testing rápido (mañana)</strong
    >
  </h2>
  <h3 data-start="2834" data-end="2858">Caso 1 — Línea nueva</h3>
  <ul class="contains-task-list" data-start="2859" data-end="2940">
    <li class="task-list-item" data-start="2859" data-end="2889">
      <p data-start="2865" data-end="2889">
        <input disabled="" type="checkbox" /> Agregar una línea nueva.
      </p>
    </li>
    <li data-start="2890" data-end="2912" class="task-list-item">
      <p data-start="2896" data-end="2912">
        <input disabled="" type="checkbox" /> Recargar página.
      </p>
    </li>
    <li class="task-list-item" data-start="2913" data-end="2940">
      <p data-start="2919" data-end="2940">
        <input disabled="" type="checkbox" /> Línea debe persistir.
      </p>
    </li>
  </ul>
  <h3 data-start="2942" data-end="2971">Caso 2 — Línea modificada</h3>
  <ul class="contains-task-list" data-start="2972" data-end="3055">
    <li class="task-list-item" data-start="2972" data-end="3011">
      <p data-start="2978" data-end="3011">
        <input disabled="" type="checkbox" /> Cambiar tipo de trabajo y precio.
      </p>
    </li>
    <li class="task-list-item" data-start="3012" data-end="3025">
      <p data-start="3018" data-end="3025">
        <input disabled="" type="checkbox" /> Reload.
      </p>
    </li>
    <li data-start="3026" data-end="3055" class="task-list-item">
      <p data-start="3032" data-end="3055">
        <input disabled="" type="checkbox" /> Cambios deben aparecer.
      </p>
    </li>
  </ul>
  <h3 data-start="3057" data-end="3085">Caso 3 — Línea eliminada</h3>
  <ul class="contains-task-list" data-start="3086" data-end="3147">
    <li class="task-list-item" data-start="3086" data-end="3107">
      <p data-start="3092" data-end="3107">
        <input disabled="" type="checkbox" /> Eliminar línea.
      </p>
    </li>
    <li class="task-list-item" data-start="3108" data-end="3121">
      <p data-start="3114" data-end="3121">
        <input disabled="" type="checkbox" /> Reload.
      </p>
    </li>
    <li class="task-list-item" data-start="3122" data-end="3147">
      <p data-start="3128" data-end="3147">
        <input disabled="" type="checkbox" /> NO debe reaparecer.
      </p>
    </li>
  </ul>
  <h3 data-start="3149" data-end="3203">
    Caso 4 — Diferenciar “payload original” de “draft”
  </h3>
  <ul class="contains-task-list" data-start="3204" data-end="3255">
    <li class="task-list-item" data-start="3204" data-end="3255">
      <p data-start="3210" data-end="3255">
        <input disabled="" type="checkbox" /> Confirmar badges correctos después
        de reload.
      </p>
    </li>
  </ul>
  <hr data-start="3257" data-end="3260" />
  <h1 data-start="3262" data-end="3299">
    <strong data-start="3264" data-end="3299"
      >Checklist final del día (5 min)</strong
    >
  </h1>
  <p data-start="3300" data-end="3323">Antes de cerrar mañana:</p>
  <ul class="contains-task-list" data-start="3325" data-end="3525">
    <li class="task-list-item" data-start="3325" data-end="3361">
      <p data-start="3331" data-end="3361">
        <input disabled="" type="checkbox" /> Confirmar que draft se guarda.
      </p>
    </li>
    <li data-start="3362" data-end="3400" class="task-list-item">
      <p data-start="3368" data-end="3400">
        <input disabled="" type="checkbox" /> Confirmar que draft se restaura.
      </p>
    </li>
    <li class="task-list-item" data-start="3401" data-end="3463">
      <p data-start="3407" data-end="3463">
        <input disabled="" type="checkbox" /> Confirmar que se limpia al
        finalizar o reiniciar wizard.
      </p>
    </li>
    <li class="task-list-item" data-start="3464" data-end="3525">
      <p data-start="3470" data-end="3525">
        <input disabled="" type="checkbox" /> Confirmar que originalRef coincide
        con el state actual.
      </p>
    </li>
  </ul>
  <hr data-start="3527" data-end="3530" />
  <p data-start="3532" data-end="3596">
    Si quieres, mañana en los primeros 10 minutos te puedo preparar:
  </p>
  <ul data-start="3598" data-end="3741">
    <li data-start="3598" data-end="3637">
      <p data-start="3600" data-end="3637">
        El archivo completo
        <code data-start="3620" data-end="3637">draftStorage.js</code>
      </p>
    </li>
    <li data-start="3638" data-end="3688">
      <p data-start="3640" data-end="3688">
        La integración exacta en
        <code data-start="3665" data-end="3688">useIngresoInitialLoad</code>
      </p>
    </li>
    <li data-start="3689" data-end="3712">
      <p data-start="3691" data-end="3712">El autosave debounced</p>
    </li>
    <li data-start="3713" data-end="3741">
      <p data-start="3715" data-end="3741">El parche para originalRef</p>
    </li>
  </ul>
  <p
    data-start="3743"
    data-end="3763"
    data-is-last-node=""
    data-is-only-node=""
  >
    Solo dime y lo hago.
  </p>
</div>
